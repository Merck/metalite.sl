---
title: "Subgroup Analysis for Baseline Characteristic"
output: rmarkdown::html_vignette
date: "2024-07-01"
vignette: >
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteIndexEntry{Subgroup Analysis for Baseline Characteristic}
  %\VignetteEncoding{UTF-8}

---

```{r, include=FALSE}
knitr::opts_chunk$set(
  comment = "#>",
  collapse = TRUE,
  out.width = "100%",
  dpi = 150
)
```

```{r}
devtools::load_all()
library(metalite)
library(metalite.sl)
library(doconv)
```

## Overview

The baseline characteristic subgroup analysis aims to provide tables to summarize details of participants by subgroup.
The development of baseline characteristic subgroup analysis involves functions:

- `prepare_base_char_subgroup()`: prepare analysis raw datasets.
- `format_base_char_subgroup()`: prepare analysis (mock) outdata with proper format.
- `rtf_base_char_subgroup()`: transfer (mock) output dataset to RTF table.

### Analysis preparation

The `prepare_base_char_subgroup()` function is designed to be used for multiple purposes.
The input of the function is a `meta` object created by the metalite package.

```{r}
meta <- meta_sl_example()
```

The output of the function is an `outdata` object containing a list of analysis
raw datasets. Key arguments are:

- `subgroup_var`: a character value of subgroup variable name in observation data saved in meta$data_observation.
- `subgroup_header`: a character vector for column header hierarchy. The first element will be the first level header and the second element will be second level header.

```{r}
outdata <- prepare_base_char_subgroup(
  meta,
  population = "apat",
  parameter = "age",
  subgroup_var = "TRTA",
  subgroup_header = c("SEX","TRTA"),
  display_subgroup_total = TRUE
)
```

The output dataset contains commonly used statistics within each `subgroup_var`.

```{r}
outdata$out_all$`Placebo`
outdata$out_all$`High Dose`
outdata$out_all$`Low Dose`
```


The information about subgroup saved with `outdata$group` and `outdata$subgroup`.

```{r}
outdata$group
outdata$subgroup
```

`n_pop`: participants in population within each `subgroup_var`.

```{r}
outdata$out_all$`Placebo`$n
outdata$out_all$`High Dose`$n
outdata$out_all$`Low Dose`$n
```

### Format output

`format_base_char_subgroup` to prepare analysis dataset before generate RTF output

```{r}
tbl <- format_base_char_subgroup(outdata)
head(tbl$tbl)
```

### RTF output
`rtf_base_char_subgroup` to generate RTF output

```{r warning=FALSE}
outdata |>
  format_base_char_subgroup() |>
  rtf_base_char_subgroup(
    source = "Source:  [CDISCpilot: adam-adsl]",
    path_outtable = "outtable/bar0char0subgroup.rtf"
  )
```

```{r, out.width = "100%", out.height = "400px", echo = FALSE, fig.align = "center"}
knitr::include_graphics("outtable/bar0char0subgroup.pdf")
```